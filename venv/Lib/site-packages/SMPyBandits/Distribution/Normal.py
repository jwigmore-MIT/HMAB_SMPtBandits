# Local  Imports
from .Distribution import Distribution

# Imports
from scipy.stats import norm
import numpy as np
from numpy.random import default_rng
rng = default_rng()


class Normal(Distribution):

    def __init__(self, *args):
        if isinstance(args[0],tuple):
            args = args[0]
        self._mu = args[0]
        self.mu = args[0]
        self._sigma = args[1]
        self.sigma = args[1]
        # Confidence Intervals
        self.mu_u = None
        self.mu_l = None
        self.sigma_l = None
        self.sigma_u = None

    def __str__(self, init = False):
        if init:
            return "N({:.3g},{:.3g})".format(self._mu, self._sigma)
        else:
            return "N({:.3g},{:.3g})".format(self.mu, self.sigma)


    def reset(self, *args):
        """Reset the parameters of the distribution. If arguments are passed replace old params with arguments"""
        if not args:
            self.mu = self._mu
            self.sigma = self._sigma
        else:
            self.mu = args[0]
            self.sigma = args[1]
            if args.__len__() >=3:
                self.mu_l= args[2]
                self.mu_u = args[3]
                self.sigma_l = args[4]
                self.sigma_u = args[5]



    def sample(self):
        return rng.normal(loc = self.mu, scale = self.sigma)

    def sample_k(self, k = 100):
        return rng.normal(loc = self.mu, scale = self.sigma,size = k)

    def getInitParams(self): # Return the initial parameters
        return self.mu, self._sigma

    def getVariance(self):
        return self.sigma**2

    def getExpVal(self):
        return self.mu

    def getPercentile(self, p):
        return norm(self.mu, self.sigma).ppf(p)

    def plot(self, ax, label = None, UCI = None, LCI = None):
        a = .005 # Quantiles for plotting
        points = 1000 # Number of points to plot
        rv = norm(self.mu, self.sigma)
        x = np.linspace(rv.ppf(a), rv.ppf(1-a), points)
        if label is None:
            label = self.__str__()
        p = ax.plot(x,rv.pdf(x), label =label)
        if UCI is not None:
            ax.axvline(x=UCI, color = p[-1].get_color(), ymax = 0.1)
        if LCI is not None:
            ax.axvline(x = LCI, color = p[-1].get_color(), ymax=0.1)
        return ax



